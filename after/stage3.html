<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stage 3</title>

<style>
    html {
        background-image: url(background.webp);
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        height: 100vh;
        margin: 0;
    }

    @font-face {
        font-family: gu;
        src: url(ChosunGu.TTF);
    }

    body {
        font-family: gu;
        margin: 0;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: space-between;
        overflow: hidden;
    }

   .formBox {
      background: radial-gradient(circle, white, #feedf3);
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 30vw;
      color: #fab6df;
      text-align: center;
      position: absolute;
      left: 10vw;
    }

    .formBox h2 {
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 24px;
    }

    label {
        display: block;
        margin: 10px 0 5px;
    }

    select {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
        font-family: gu;
        background: white;
        color: #fab6df;
        font-size: 15px;
    }

    option {
        color: black;
    }

    button {
        width: 100%;
        background-color: #fab6df;
        color: white;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-family: gu;
    }

    .characterDisplay {
        position: absolute;
        width: 60%;
        height: 100vh;
        right: 0;
    }

    #characterBody, #characterEyes {
        position: absolute;
        right: 5vw;
        top: 0;
        width: 50vw;
        pointer-events: none;
    }

    /* --- NEW INFO BUTTON (image like Stage 1) --- */
    #infoButton {
        position: fixed;
        top: 1vh;
        right: 1vw;
        width: 4vw;
        min-width: 30px;
        cursor: pointer;
        z-index: 10;
    }

    /* --- NEW WHITE BLURRED MODAL BACKDROP --- */
    #infoModal {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(4px);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 20;
    }

    /* --- NEW MODAL BOX --- */
    #infoContent {
        background: #ffffff;
        padding: 3vh 3vw;
        border-radius: 1vh;
        width: 50vw;
        max-width: 600px;
        text-align: center;
        color: #fab6df;
        font-size: 2vh;
        box-shadow: 0 0 1.5vh #fab6df;
        position: relative;
    }

    #closeModal {
        position: absolute;
        top: 1vh;
        right: 1vw;
        font-size: 3vh;
        cursor: pointer;
        color: #fab6df;
    }

</style>

</head>
<body>

    <!-- NEW INFO BUTTON IMAGE -->
    <img id="infoButton" src="info.webp" alt="Info">

    <!-- NEW WHITE BLURRED MODAL -->
    <div id="infoModal">
        <div id="infoContent">
            <span id="closeModal">&times;</span>
            <h3>Why We Ask For This</h3>
            <p>
                Education, major, and job stability influence your reproductive suitability score.<br><br>
                Higher-income or stable fields improve your ability to support future offspring,
                while unstable or low-income careers decrease long-term reproductive security.
            </p>
        </div>
    </div>

    <!-- LEFT SIDE PINK FORM BOX -->
    <div class="formBox">
        <h2>Your Profile</h2>

        <label>Final Education</label>
        <select id="education" required>
            <option value="">Choose...</option>
            <option value="High School">High School</option>
            <option value="Bachelor">Bachelor</option>
            <option value="Master">Master</option>
            <option value="PhD">PhD</option>
            <option value="Other">Other</option>
        </select>

        <label>Major in University</label>
        <select id="major" required>
            <option value="">Choose...</option>

            <option value="Computer Science">Computer Science</option>
            <option value="Engineering">Engineering</option>
            <option value="Business">Business</option>

            <option value="Fine Arts">Fine Arts</option>
            <option value="Design">Design</option>
            <option value="Psychology">Psychology</option>

            <option value="Other">Other</option>
        </select>

        <label>Current Job</label>
        <select id="job" required>
            <option value="">Choose...</option>

            <option value="Developer">Developer</option>
            <option value="Designer">Designer</option>
            <option value="Researcher">Researcher</option>

            <option value="Artist">Artist</option>
            <option value="Student">Student</option>
            <option value="Unemployed">Unemployed</option>

            <option value="Other">Other</option>
        </select>

        <button id="finish">Next</button>
    </div>

    <!-- RIGHT SIDE DISPLAY -->
    <div class="characterDisplay">
        <img id="characterBody" src="">
        <img id="characterEyes" src="">
    </div>

<script>
    // Load chosen appearance from Stage 2
    const body = localStorage.getItem('chosenBody');
    const eyes = localStorage.getItem('chosenEyes');

    if (body) document.getElementById("characterBody").src = body;
    if (eyes) document.getElementById("characterEyes").src = eyes;

    // NEW MODAL LOGIC (same as other page)
    const infoButton = document.getElementById("infoButton");
    const infoModal = document.getElementById("infoModal");
    const closeModal = document.getElementById("closeModal");

    infoButton.addEventListener("click", () => { infoModal.style.display = "flex"; });
    closeModal.addEventListener("click", () => { infoModal.style.display = "none"; });
    infoModal.addEventListener("click", (e) => { 
        if (e.target === infoModal) infoModal.style.display = "none"; 
    });

    // POINT SYSTEM
    const educationPoints = {
        "High School": -1,
        "Bachelor": 0,
        "Master": 1,
        "PhD": 1,
        "Other": 0
    };

    const majorPoints = {
        "Computer Science": 1,
        "Engineering": 1,
        "Business": 1,
        "Fine Arts": -1,
        "Design": -1,
        "Psychology": -1,
        "Other": 0
    };

    const jobPoints = {
        "Developer": 1,
        "Designer": 1,
        "Researcher": 1,
        "Artist": -1,
        "Student": -1,
        "Unemployed": -1,
        "Other": 0
    };

    document.getElementById("finish").addEventListener("click", () => {

        const edu = document.getElementById("education").value;
        const major = document.getElementById("major").value;
        const job = document.getElementById("job").value;

        if (!edu || !major || !job) {
            alert("Please fill out all fields!");
            return;
        }

        localStorage.setItem("finalEducation", edu);
        localStorage.setItem("finalMajor", major);
        localStorage.setItem("currentJob", job);

        let stage3Points = 0;
        stage3Points += educationPoints[edu] || 0;
        stage3Points += majorPoints[major] || 0;
        stage3Points += jobPoints[job] || 0;

        localStorage.setItem("finalScore", stage3Points);

        const stage1Points = parseInt(localStorage.getItem("agePoints") || 0);
        const stage2Points = parseInt(localStorage.getItem("points") || 0);

        const cumulativeScore = stage1Points + stage2Points + stage3Points;
        localStorage.setItem("cumulativeScore", cumulativeScore);

        window.location.href = "stage4.html";
    });
</script>

</body>
</html>
